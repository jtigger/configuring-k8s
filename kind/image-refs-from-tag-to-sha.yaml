#! image-refs-from-tag-to-sha.yaml
#! - applies to dependencies/ingress-nginx.yaml
#! - replaces tags with their digest equivalents for referenced container images. This ensures that the images
#!   we are installing are exactly the ones selected by the author (tags can be moved, digests are immutable).
---
#@ load("@ytt:overlay", "overlay")

#@overlay/match by=overlay.subset({"kind": "Deployment", "metadata": {"name":"ingress-nginx-controller"}})
---
spec:
  template:
    spec:
      containers:
        #@overlay/match by="name"
        - name: controller
          #! https://quay.io/repository/kubernetes-ingress-controller/nginx-ingress-controller?tab=tags
          #! source tag: 0.32.0
          image: quay.io/kubernetes-ingress-controller/nginx-ingress-controller@sha256:251e733bf41cdf726092e079d32eed51791746560fff4d59cf067508ed635287

#@overlay/match by=overlay.subset({"kind": "Job", "metadata": {"name":"ingress-nginx-admission-create"}})
---
spec:
  template:
    spec:
      containers:
        #@overlay/match by="name"
        - name: create
          #! https://hub.docker.com/r/jettech/kube-webhook-certgen/tags
          #! source tag: 1.20.0
          image: jettech/kube-webhook-certgen@sha256:a5130405b0476373946b5c8f25a5506d0e4e480afb803ef0f0908a5ffd14111a


#@overlay/match by=overlay.subset({"kind": "Job", "metadata": {"name":"ingress-nginx-admission-patch"}})
---
spec:
  template:
    spec:
      containers:
        #@overlay/match by="name"
        - name: patch
          #! https://hub.docker.com/r/jettech/kube-webhook-certgen/tags
          #! source tag: 1.20.0
          image: jettech/kube-webhook-certgen@sha256:a5130405b0476373946b5c8f25a5506d0e4e480afb803ef0f0908a5ffd14111a
